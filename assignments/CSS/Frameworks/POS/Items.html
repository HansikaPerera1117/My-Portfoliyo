<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Framework POS System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="assests/css/bootstrap.min.css" rel="stylesheet">

    <!------------------------stylesheets--------------------------------->
    <link rel="stylesheet" href="assests/styles/navbar.css">

    <!---------------------------font links------------------------------------>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Saira:wght@600&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" rel="stylesheet">
</head>

<body>
<header>
    <!-----------------------nav bar start--------------------------------------------->
    <nav class="myNav">
        <div class="container-fluid">

            <!---------------------------menu button start---------------------------------->
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
                <img src="assests/Images/menu.png" alt="menu icone" width="40" height="40" class="d-inline-block align-text-top">
            </button>

            <div  class=" myf offcanvas offcanvas-start " tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel" >
                <div class="menu" >
                    <a href="index.html"> <img src="assests/Images/home.png" alt="home icon" height="60" width="60"></a>
                    <p>Home</p>
                </div>
                <div class="menu">
                    <a href="PlaceOrders.html"><img src="assests/Images/order.png" alt="Order icon" height="60" width="60"></a>
                    <p>Orders</p>
                </div>
                <div class="menu">
                    <a href="Customers.html"><img src="assests/Images/customer.png" alt="Customer icon" height="60" width="60"></a>
                    <p>Customers</p>
                </div>
                <div class="menu">
                    <a href="Items.html"> <img src="assests/Images/items.png" alt="item icon" height="60" width="60"></a>
                    <p>Items</p>
                </div>

                <div class="menu1">
                    <img src="assests/Images/signin.png" alt="signup icon" height="25" width="25">
                    <a>Sign Up</a>
                    <img src="assests/Images/logout.png" alt="logout icon" height="25" width="25">
                    <a>LogOut</a>
                </div>

            </div>
            <!---------------------------menu button end---------------------------------->

            <img src="assests/Images/logo.png" alt="Logo" width="83" height="90" class="logo d-inline-block align-text-top">
            <p class="name">Royal Grocery</p>


            <div class="dateTime">
                <p>Date : 0000-00-00 Time : 0000:00:00</p>
            </div>
            <div class="nav">
                <img src="assests/Images/signin.png" alt="signup icon" height="25" width="25">
                <a>Sign Up</a>
                <img src="assests/Images/logout.png" alt="logout icon" height="25" width="25">
                <a>LogOut</a>
            </div>
        </div>
    </nav>
    <!-----------------------nav bar end--------------------------------------------->
</header>

<main class="container-fluid">
    <!----------------------main bg start------------------------------------->
    <div class="m-2">
        <img src="assests/Images/items.png" alt="Item icon" width="40" height="40" class="d-inline-block align-text-top">
        <span id="label">Items</span>
    </div>
    <div class="row mx-auto " id="mainBg" >
        <div class="col-12" id="navbar">
            <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="Home.html" id="home">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Items</li>
                </ol>
            </nav>
        </div>

        <div class="col-8 " style="height: 240px">
            <div class="container text-center">
                <div class="row ms-1 me-1">
                    <form class="col" id="searchBox">
                        <div class="row">
                            <div class="col text-start" id="searchBoxHeading">
                                <span  id="search">Search Items</span>
                            </div>
                            <div class="row align-items-center" style="height: 85px">
                                <div class="col-9">
                                    <input class="form-control"  id="searchBar" placeholder="Input Item Code / Name Here" style="height: 53px">
                                </div>
                                <div class="col-3" >
                                    <select id="cmbNames" class="form-select" aria-label="Default select example" style="height: 53px">
                                        <option selected>Item Names</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row align-items-center" style="height: 70px">
                                <div class="col text-start" >
                                    <button type="button" class="btn" id="searchButton" data-bs-target="#ItemDetailsModal" data-bs-toggle="modal">Search</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-4" style="height: 240px">
            <div class="row me-1 " style="height: 80px">
                <div class="col"></div>
                <div class="col align-self-end">
                    <button type="button" class="btn btn-primary text-black" id="newCustomer" data-bs-target="#newItemModal" data-bs-toggle="modal" type="button">New Item</button>

                    <!---------------------New Item Modal start----------------->
                    <div aria-hidden="true" aria-labelledby="newItemModalLabel" class="modal fade" id="newItemModal" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="newItemModalLabel">New Item</h5>
                                    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="newItemForm">
                                        <div class="mb-3">
                                            <span style="font-size: 20px" id="Code"><strong>Item Code : <label class="form-label" for="Code" id="ItemCode">P001</label></strong></span>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="inputItemName">Item Name</label>
                                            <input class="form-control" id="inputItemName" type="text" placeholder="Keerisamba 5Kg">
                                            <span class="control-error" id="lblitmname"></span>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="inputItemPackSize">Pack Size</label>
                                            <input class="form-control" id="inputItemPackSize" multiple type="text" placeholder="Kg/g/l/ml...">
                                            <span class="control-error" id="lblitmpacksize"></span>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="inputItemPrice">Price</label>
                                            <input class="form-control" id="inputItemPrice" type="number" placeholder="0000.00">
                                            <span class="control-error" id="lblitmprice"></span>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="inputItemQuantity">Quantity</label>
                                            <input class="form-control " id="inputItemQuantity" type="number" placeholder="0000">
                                            <span class="control-error" id="lblitmqty"></span>
                                        </div>
                                        <div class="row justify-content-end">
                                            <div class="col-7 me-0">
                                                <button class="btn text-white ms-3 " style="background-color: rgb(227,133,133)" type="button" id="btnSaveItem">Save Item</button>
                                                <button class="btn btn-primary" type="reset" form="newItemForm">Renew</button>
                                                <button class="btn btn-secondary " data-bs-dismiss="modal" type="button">Close</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!---------------------New Item Modal end----------------->

                </div>
            </div>
            <div class="row me-1" style="height: 80px">
                <div class="col"></div>
                <div class="col text-start align-self-end" >
                    <button type="button" class="btn btn-warning" id="viewAll" data-bs-target="#ViewAllItemsModal" data-bs-toggle="modal" type="button" >View All Items</button>

                    <!---------------------View all Customer Modal start----------------->
                    <div aria-hidden="true" aria-labelledby="ViewAllItemsModalLabel" class="modal fade" id="ViewAllItemsModal" tabindex="-1">
                        <div class="modal-dialog" style="--bs-modal-width: 1250px">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="ViewAllItemsModalLabel">List of All Items</h5>
                                    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                                </div>
                                <div class="modal-body">
                                    <section>
                                        <table class="table table-bordered table-hover mt-2">
                                            <thead class="text-black" style=" background-color:  rgba(255, 204, 204, 1)">
                                            <tr>
                                                <th>Item Code</th>
                                                <th>Item Name</th>
                                                <th>Pack Size</th>
                                                <th>Price</th>
                                                <th>Quantity</th>
                                            </tr>
                                            </thead>
                                            <tbody class="tblItems">

                                            </tbody>
                                        </table>
                                        <div class="row justify-content-end">
                                            <div class="col-1 me-0">
                                                <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
                                            </div>
                                        </div>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--------------------View all Customer Modal end----------------->


                </div>
            </div>
        </div>

        <div class="col-12" style="height: 80px">
            <div class="btn-group mt-2 ms-5" role="group" aria-label="Basic mixed styles example" style="height: 55px">

                <button  id="btnItemDelete" type="button" class="btn btn-danger" style="width: 90px">Delete</button>

                <button type="button" class="btn btn-primary" style="width: 90px" data-bs-target="#ItemDetailsModal" data-bs-toggle="modal" type="button">Details</button>

                <!--------------------- Item Details Modal start----------------->
                <div aria-hidden="true" aria-labelledby="ItemDetailsModalLabel" class="modal fade" id="ItemDetailsModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="ItemDetailsModalLabel"  style="font-size: 20px"><strong>Item Code : <label class="form-label" id="ICode">P001</label></strong></h5>
                                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                            </div>
                            <div class="modal-body">
                                <section>
                                    <div class="mb-3">
                                        <label class="form-label" for="inputIName">Item Name</label>
                                        <input class="form-control" id="inputIName" type="text">
                                        <span class="control-error" id="lblitamname"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label" for="inputIPacketSize">Pack Size</label>
                                        <input class="form-control" id="inputIPacketSize" multiple type="text">
                                        <span class="control-error" id="lblitampacksize"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label" for="inputIPrice">Price</label>
                                        <input class="form-control" id="inputIPrice" type="number">
                                        <span class="control-error" id="lblitamprice"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label" for="inputIQuantity">Quantity</label>
                                        <input class="form-control " id="inputIQuantity" type="number">
                                        <span class="control-error" id="lblitamqty"></span>
                                    </div>
                                    <div class="row justify-content-end">
                                        <div class="col-7 ">
                                            <button class="btn btn-warning text-white ms-2" type="button" id="updateItem">Update Item</button>
                                            <button class="btn btn-primary" type="button" id="btnReset">Reset</button>
                                            <button class="btn btn-secondary " data-bs-dismiss="modal" type="button">Close</button>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
                <!---------------------Item Details Modal end----------------->



                <button type="reset" form="searchBox" class="btn btn-success" style="width: 70px">Clear</button>
            </div>
        </div>

        <div class="col-12" style="height:210px">

            <table class="table table-bordered table-hover mt-2">
                <thead class="text-black" style=" background-color:  rgba(255, 204, 204, 1)">
                <tr>
                    <th>Item Code</th>
                    <th>Item Name</th>
                    <th>Pack Size</th>
                    <th>Price</th>
                    <th>Quantity</th>
                </tr>
                </thead>
                <tbody class="tblItems">

                </tbody>
            </table>
        </div>
    </div>
    <!----------------------main bg end------------------------------------->
</main>

<script src="assests/js/bootstrap.min.js"></script>
<script src="assests/JQuery/jquery-3.6.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.37/dist/sweetalert2.all.min.js"></script>

<script>

    $("#searchBar").focus();

    var items=[];

    $("#btnSaveItem").click(function (){
       saveItem();
    });

    function saveItem(){
        let itemCode = $("#ItemCode").text();
        let itemName = $("#inputItemName").val();
        let packSize = $("#inputItemPackSize").val();
        let price = $("#inputItemPrice").val();
        let quantity = $("#inputItemQuantity").val();


        var itemObject = {
            code: itemCode,
            name: itemName,
            packSize: packSize,
            price: price,
            qty: quantity,
        }

        let afterCount = items.length;
        console.log(afterCount);
        let beforCount = afterCount+1;
        console.log(beforCount);

        items.push(itemObject);

        if (beforCount == items.length){
            Swal.fire({
                position: 'top-end',
                icon: 'success',
                title: 'Item has been saved successfully...',
                showConfirmButton: false,
                timer: 1500
            })
        }else{
            Swal.fire({
                position: 'top-end',
                icon: 'error',
                title: 'Unsuccessful...',
                showConfirmButton: false,
                timer: 1500
            })
        }

        console.log(items);

        loadAllItems();

        loadItemNames();

        bindRowClickEvents();

    }

    function loadAllItems(){
        $(".tblItems").empty();

        for(var item of items){
            var row= `<tr> <td>${item.code}</td><td>${item.name}</td><td>${item.packSize}</td><td>${item.price}</td><td>${item.qty}</td></tr>`;

            $(".tblItems").append(row);
        }
    }

    function bindRowClickEvents() {
        $(".tblItems>tr").click(function () {
            let id = $(this).children(":eq(0)").text();
            $("#searchBar").val(id);
        });
    }

    function loadItemNames(){
        $("#cmbNames").empty();
        var selected = `<option selected>Item Names</option>`;
        $("#cmbNames").append(selected);

        for (var item of items){
            // console.log(item);

            var names =  `<option>${item.name}</option>`;

            // console.log(names);

            $("#cmbNames").append(names);
        }
    }

    $("#cmbNames").click(function () {
        let name = $('#cmbNames>option:selected').val();

        for (let i = 0; i < items.length; i++) {
            let itemName = items[i].name;

            if (itemName == name){
                $("#searchBar").val(name);
            }

        }

    })


    $("#viewAll").click(function (){
        loadAllItems();
    });


    $("#searchButton").click(function (){

        let search = $("#searchBar").val();

        let item = searchItem(search);

                $("#ICode").text(item.code);
                $("#inputIName").val(item.name);
                $("#inputIPacketSize").val(item.packSize);
                $("#inputIPrice").val(item.price);
                $("#inputIQuantity").val(item.qty);


    });

    $("#btnItemDelete").click(function (){

        let search = $("#searchBar").val();

        console.log(items);

        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {

                if (deleteItem(search)) {
                    Swal.fire(
                        'Deleted!',
                        'Item ' +search + ' has been deleted successfully',
                        'success'
                    )
                } else {
                    alert("No such Item to delete. please check the code or name");
                }

                loadAllItems()

                loadItemNames()

                console.log(items);

            }
        })
    });

    $("#updateItem").click(function () {

        let search = $("#searchBar").val();

        let response = updateItem(search);
        if (response) {
            Swal.fire({
                position: 'top-end',
                icon: 'success',
                title: 'Item has been updated successfully...',
                showConfirmButton: false,
                timer: 1500
            })
        } else {
            Swal.fire({
                position: 'top-end',
                icon: 'error',
                title: 'Unsuccessful...',
                showConfirmButton: false,
                timer: 1500
            })

        }
    });

    $("#btnReset").click(function (){
        let typedItm = $("#searchBar").val();
        let item = searchItem(typedItm);
        if (item != null) {
            setTextfieldValues(item.name, item.packSize, item.price, item.qty);
        } else {
            alert("There is no item available for that " + typedItm);
            setTextfieldValues("", "", "", "");
        }
    });

    function setTextfieldValues( name, packSize,price, qty) {

        $("#inputIName").val(name);
        $("#inputIPacketSize").val(packSize);
        $("#inputIPrice").val(price);
        $("#inputIQuantity").val(qty);
    }

    function updateItem(itm) {
        let item = searchItem(itm);
        if (item != null) {

            item.name = $("#inputIName").val();
            item.packSize = $("#inputIPacketSize").val();
            item.price = $("#inputIPrice").val();
            item.qty = $("#inputIQuantity").val();

            loadAllItems()

            loadItemNames()

            return true;
        } else {
            return false;
        }

    }

    function deleteItem(itm) {
        let item = searchItem(itm);
        if (item != null) {
            let indexNumber = items.indexOf(item);
            items.splice(indexNumber, 1);
            loadAllItems()
            return true;
        } else {
            return false;
        }
    }

    function searchItem(itm) {
        for (let item of items) {
            if (item.code == itm || item.name == itm) {
                return item;
            }
        }
        return null;
    }


    $("#inputItemName").focus();

    const itmNameRegEx = /^[A-z ]{5,40}$/;
    const itmPackSizesRegEx = /^[1-9][0-9]{0,5}(g|kg|ml|l)$/;
    const itmPriceRegEx = /^[0-9]{1,}[.]?[0-9]{1,2}$/;
    const itmQtyRegEx = /^[1-9][0-9]{0,3}$/;

    let itemValidations = [];
    itemValidations.push({reg: itmNameRegEx, field: $('#inputItemName'),error:'Item Name Pattern is Wrong : A-z 5-40'});
    itemValidations.push({reg: itmPackSizesRegEx, field: $('#inputItemPackSize'),error:'Item PackSizes Pattern is Wrong : 0-9 with g/kg/ml/l'});
    itemValidations.push({reg: itmPriceRegEx, field: $('#inputItemPrice'),error:'Item Price Pattern is Wrong : 100 or 100.00'});
    itemValidations.push({reg: itmQtyRegEx, field: $('#inputItemQuantity'),error:'Item Quantity Pattern is Wrong : 1-9'});


    $("#inputItemName,#inputItemPackSize,#inputItemPrice,#inputItemQuantity").on('keydown', function (event) {
        if (event.key == "Tab") {
            event.preventDefault();
        }
    });

    $("#inputItemName,#inputItemPackSize,#inputItemPrice,#inputItemQuantity").on('keyup', function (event) {
        checkValidity();
    });

    $("#inputItemName,#inputItemPackSize,#inputItemPrice,#inputItemQuantity").on('blur', function (event) {
        checkValidity();
    });


    $("#inputItemName").on('keydown', function (event) {
        if (event.key == "Enter" && check(itmNameRegEx, $("#inputItemName"))) {
            $("#inputItemPackSize").focus();
        } else {
            focusText($("#inputItemName"));
        }
    });


    $("#inputItemPackSize").on('keydown', function (event) {
        if (event.key == "Enter" && check(itmPackSizesRegEx, $("#inputItemPackSize"))) {
            focusText($("#inputItemPrice"));
        }
    });


    $("#inputItemPrice").on('keydown', function (event) {
        if (event.key == "Enter" && check(itmPriceRegEx, $("#inputItemPrice"))) {
            focusText($("#inputItemQuantity"));
        }
    });


    $("#inputItemQuantity").on('keydown', function (event) {
        if (event.key == "Enter" && check(itmQtyRegEx, $("#inputItemQuantity"))) {
            let res = confirm("Do you want to add this item.?");
            if (res) {
                saveItem();
                clearAllTexts();
            }
        }
    });

    function checkValidity() {
        let errorCount=0;
        for (let validation of itemValidations) {
            if (check(validation.reg,validation.field)) {
                textSuccess(validation.field,"");
            } else {
                errorCount=errorCount+1;
                setTextError(validation.field,validation.error);
            }

        }
        setButtonState(errorCount);

    }

    function check(regex, txtField) {
        let inputValue = txtField.val();
        return regex.test(inputValue) ? true : false;
    }

    function setTextError(txtField,error) {
        if (txtField.val().length <= 0) {
            defaultText(txtField,"");
        } else {
            txtField.css('border', '2px solid red');
            txtField.parent().children('span').text(error);
        }
    }

    function textSuccess(txtField,error) {
        if (txtField.val().length <= 0) {
            defaultText(txtField,"");
        } else {
            txtField.css('border', '2px solid green');
            txtField.parent().children('span').text(error);
        }
    }

    function defaultText(txtField,error) {
        txtField.css("border", "1px solid #ced4da");
        txtField.parent().children('span').text(error);
    }

    function focusText(txtField) {
        txtField.focus();
    }

    function setButtonState(value){
        if (value>0){
            $("#btnSaveItem").attr('disabled',true);
        }else{
            $("#btnSaveItem").attr('disabled',false);
        }
    }

    function clearAllTexts() {
        $("#inputItemName").focus();
        $("#inputItemName,#inputItemPackSize,#inputItemPrice,#inputItemQuantity").val("");
        checkValidity();
    }


</script>
</body>

</html>